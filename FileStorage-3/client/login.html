<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>FileStorage ‚Äî –í—Ö–æ–¥</title>
    <link rel="stylesheet" href="css/common.css" />
    <link rel="stylesheet" href="css/auth.css" />
  </head>
  <body class="auth-page">
    <h1>FileStorage</h1>
    <h2>–í—Ö–æ–¥</h2>
    <form id="loginForm">
      <label>
        E-mail:
        <input type="email" name="email" required />
      </label>
      <label>
        –ü–∞—Ä–æ–ª—å:
        <div class="password-container">
          <input type="password" name="password" pattern="[0-9]{8}" required />
          <span class="password-toggle" id="passwordToggle">üëÅÔ∏è</span>
        </div>
        <em class="password-hint">–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 8 —Ü–∏—Ñ—Ä</em>
      </label>
      <button type="submit">–í–æ–π—Ç–∏</button>

      <!-- –î–æ–±–∞–≤–ª—è–µ–º div –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π -->
      <div id="statusMessage" class="status-message"></div>
    </form>
    <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="/register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>

    <script>
      const form = document.getElementById("loginForm");
      const statusMessage = document.getElementById("statusMessage");
      const passwordInput = document.querySelector('input[name="password"]');
      const passwordToggle = document.getElementById("passwordToggle");

      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
      passwordToggle.addEventListener("click", function () {
        const type = passwordInput.getAttribute("type");
        if (type === "password") {
          passwordInput.setAttribute("type", "text");
          this.textContent = "üîí";
        } else {
          passwordInput.setAttribute("type", "password");
          this.textContent = "üëÅÔ∏è";
        }
      });

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = new FormData(form);
        const data = {
          email: formData.get("email"),
          password: formData.get("password"),
        };

        try {
          const response = await fetch("/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          if (response.ok) {
            // –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            window.location.href = "/index.html";
          } else {
            const result = await response.text();
            statusMessage.textContent = result || "–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å";
            statusMessage.className = "status-message error";
          }
        } catch (error) {
          statusMessage.textContent =
            "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
          statusMessage.className = "status-message error";
        }
      });
    </script>
  </body>
</html>
